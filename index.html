<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit details</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery UI CSS for Datepicker -->
  <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5" style="width:100%; max-width:420px;">
  <h2 class="text-center mb-4">Submit details</h2>


	<div class="mb-3">
		<label for="Date" class="form-label">Date</label>
		<input type="text" class="form-control" id="Date" placeholder="Select a Date" required>
		</div>

    <div class="mb-3">
      <label for="Store" class="form-label">Store</label>
      <input type="text" class="form-control" id="Store" placeholder="Store Name" required>
    </div>
    
    <!-- Email Field -->
    <div class="mb-3">
      <label for="Branch" class="form-label">Branch</label>
      <input type="text" class="form-control" id="Branch" placeholder="Branch Name" required>
    </div>
    
	<!-- Dynamic Item Name and Qty Fields -->
	<div class="mb-3">
		<label class="form-label">Items</label>
		<div id="items-container">
			<div class="row g-2 mb-2 item-row">
			<div class="col-md-8">
				<input type="text" class="form-control item-name" placeholder="Item Name" required>
			</div>
			<div class="col-md-4">
				<input type="number" class="form-control item-qty" placeholder="Qty" required>
			</div>
			</div>
		</div>
		<button type="button" class="btn btn-secondary" id="add-item-btn">Add Another Item</button>
		</div>

    <!-- Message Field -->
    <div class="mb-3">
      <label for="Message" class="form-label">Message</label>
      <textarea class="form-control" id="Message" rows="2" placeholder="Your Message" required></textarea>
    </div>
    <div id="euStatus" style="margin-bottom:8px;font-weight:bold;">Loading...</div>
    <!-- Submit Button -->
	<input type="hidden" id="euGID" value="AKfycbz00K48ssY9Km1MiRnEtov6Gc0GG530ytUfcJRJYCf1Nv1qR07yn1YFfQ1qjXtgzCoT">
    <button type="submit" id="submit_btn" class="btn btn-primary">Submit</button>

</div>

<!-- jQuery and jQuery UI for Datepicker -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

<script>
  // Initialize Datepicker
  $(function() {
	$("#euStatus").hide();
    $("#Date").datepicker({
      dateFormat: "dd-MM-yy"
    });
  });

  // Function to Add New Item Row
  $('#add-item-btn').click(function() {
	const newRow = `
      <div class="row g-2 mb-2 item-row">
        <div class="col-md-8">
          <input type="text" class="form-control item-name" placeholder="Item Name" required>
        </div>
        <div class="col-md-4">
          <input type="number" class="form-control item-qty" placeholder="Qty" required>
        </div>
      </div>
    `;
    $('#items-container').append(newRow);
  });

  $('#submit_btn').click(function() 
  {
	if($("#Date").val() != "" && $("#Store").val() != "" && $("#Branch").val() != "")
	{
		$('.item-row').each(function() {
			let itemName = $(this).find('.item-name').val();
			let itemQty = $(this).find('.item-qty').val();

			if (itemName && itemQty) {
				//console.log(itemName, itemQty);
				$("#euStatus").show();
				$("#euStatus").html("<span style='color:#000;'>Submitting data, please wait...</span>");
				$.post("https://script.google.com/macros/s/"+$("#euGID").val()+"/exec",
				{
					Date: $("#Date").val(),
					Store: $("#Store").val(),
					Branch: $("#Branch").val(),
					Item_Code: itemName,
					Quantity: itemQty,
					Message: $("#Message").val()
				},
				function (data, status) {
					alert("Data: " + data.result + "\nStatus: " + status);
					if(data.result == "success")
					{
						$("#euStatus").html("<span style='color:#46b129;'>Successuly Submitted!</span>");
						//$("#euFirstName").val(""); $("#euLastName").val(""); $("#euEmail").val(""); $("#euMobile").val(""); $("#euCity").val(""); $("#euChannel").val(""); $("#euURL").val(""); $("#euPaypal").val("");
					}
					else{
						$("#euStatus").html("<span style='color:#ff0000;'>Something went wrong, please try again</span>");
					}
				}
				).fail(function(jqXHR, textStatus, errorThrown) {
  console.error("Error Status: ", textStatus);
  console.error("Error Thrown: ", errorThrown);
  console.error("Response Text: ", jqXHR.responseText);
  //alert("Failed to submit the data. Status: " + textStatus + "\nError: " + errorThrown);
});
			}
			else{
				$("#euStatus").show();
				$("#euStatus").html("<span style='color:#ff0000;'>Please fill all the fields</span>");
			}
		});
	}
	else{
		$("#euStatus").show();
		$("#euStatus").html("<span style='color:#ff0000;'>Please fill all the fields</span>");
	}
  });
</script>

</body>
</html>
